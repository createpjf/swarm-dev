# ⬡ Swarm

**Multi-agent orchestration that plans, executes, and quality-checks your tasks.**

Agents collaborate through file-backed channels, self-claim tasks, peer-review each other, and evolve when performance drops. Process-native, model-agnostic, zero infrastructure.

---

## Quick Start

```bash
# 1. Install & configure (one command)
git clone https://github.com/createpjf/swarm-dev.git && cd swarm-dev
bash setup.sh          # installs deps → launches setup wizard

# 2. Use it
swarm                  # interactive chat
swarm run "your task"  # one-shot

# 3. Dashboard (optional)
swarm gateway start    # opens http://127.0.0.1:19789
```

> Only one API key needed. `setup.sh` auto-detects local Ollama if running.

---

## What Happens When You Submit a Task

```
You: "Build a REST API for user management"
  │
  ▼
Planner → decomposes into subtasks
  │
  ▼
Executor → implements each subtask (streaming output)
  │
  ▼
Advisor → reviews quality, suggests fixes
  │
  ▼
Result → with cost estimate and agent attribution
```

The dashboard shows this in real-time: streaming output, subtask tree, agent status, cost per task.

---

## CLI Cheat Sheet

| Command | What it does |
|---------|-------------|
| `swarm` | Interactive chat mode |
| `swarm onboard` | Setup wizard (re-run anytime) |
| `swarm run "..."` | One-shot task |
| `swarm status` | Task board |
| `swarm scores` | Reputation scores |
| `swarm doctor` | System health check |
| `swarm gateway start` | Start dashboard |
| `swarm agents create <name>` | Create agent (`--template coder\|researcher\|debugger\|doc_writer`) |
| `swarm workflow list` | List available workflows |
| `swarm workflow run <name>` | Run a workflow (e.g., `code_review`, `bug_fix`, `brainstorm`) |
| `swarm chain status` | On-chain identity status |

**Chat commands** (inside interactive mode): `/status` `/scores` `/config` `/configure` `/doctor` `/workflows` `/cancel` `/clear` `/help`

---

## Core Concepts

| Concept | Summary |
|---------|---------|
| **TaskBoard** | File-locked task lifecycle: create → claim → review → complete |
| **ContextBus** | Shared KV store — agent outputs feed into other agents' prompts |
| **Reputation** | 5-dimension EMA scoring (quality 30%, completion 25%, improvement 25%, consistency 10%, review accuracy 10%) |
| **Evolution** | Score < 40 triggers: Path A (prompt upgrade) → B (model swap) → C (role restructure) |
| **Skills** | Hot-reload markdown files in `skills/`. Edit → next task picks up changes |
| **Workflows** | YAML pipelines with dependency graphs, variable passing, approval gates |
| **Memory** | 3-layer episodic (L0 index → L1 summary → L2 full) + shared Zettelkasten KB |

---

## Workflows

Built-in templates — run without setup:

```bash
swarm workflow run code_review --input "Review auth module"
swarm workflow run bug_fix --input "Login fails on empty password"
swarm workflow run documentation --input "Write API docs for /users endpoint"
swarm workflow run brainstorm --input "Ways to improve onboarding UX"
swarm workflow run research_report --input "Compare React vs Vue in 2025"
```

Create your own: drop a YAML file in `workflows/`. See existing templates for the format.

---

## Dashboard

`swarm gateway start` opens the web dashboard at `http://127.0.0.1:19789`:

- **Overview** — Real-time streaming output, subtask tree, agent status chips
- **Agents** — Cards with model, skills, reputation sparkline, inline editor
- **Skills** — Full CRUD for skill documents
- **Usage** — Token counts, cost breakdown by agent and model
- **Logs** — Per-agent logs with level filter
- **Health** — Diagnostic checks (same as `swarm doctor`)

---

## Configuration

All config lives in `config/agents.yaml` (auto-generated by `swarm onboard`):

```yaml
llm:
  provider: flock

agents:
  - id: planner
    role: "Strategic planner — decomposes tasks"
    model: minimax-m2.1
    skills: [_base, planning]
  - id: executor
    role: "Implementation agent — writes solutions"
    model: minimax-m2.1
    skills: [_base, coding]
  - id: reviewer
    role: "Advisor — reviews quality"
    model: deepseek-v3.2
    skills: [_base, review]
```

Each agent can have its own provider, API key, model, fallback chain, and skills.

---

## FAQ / Troubleshooting

**"API key not set"** — Run `swarm onboard` or edit `.env` line 7.

**"Cannot reach LLM"** — Check your internet connection and Base URL. Run `swarm doctor` for diagnostics.

**"Port 19789 in use"** — Another gateway is running. Use `swarm gateway stop` first, or set `SWARM_GATEWAY_PORT` in `.env`.

**Tasks stuck in "claimed"** — Agent may have crashed. Tasks auto-recover after 5 min timeout, or use `/cancel` to manually cancel.

**How to use Ollama (free, local)?** — Install Ollama, pull a model (`ollama pull llama3`), then run `swarm onboard`. It auto-detects Ollama.

**How to add a new agent?** — `swarm agents create my_agent --template coder`

---

## API Endpoints

Gateway runs on port **19789** (`SWARM_GATEWAY_PORT`). Auth: `Authorization: Bearer <token>`.

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/` | Web dashboard |
| `POST` | `/v1/task` | Submit a task |
| `GET` | `/v1/task/:id` | Task status |
| `GET` | `/v1/status` | Full task board |
| `GET` | `/v1/scores` | Reputation scores |
| `GET` | `/v1/scores/history` | Score trend data |
| `GET` | `/v1/agents` | Team info |
| `GET` | `/v1/heartbeat` | Agent liveness |
| `GET` | `/v1/usage` | Token usage stats |
| `GET` | `/v1/doctor` | Health check |
| `GET` | `/v1/skills` | List skills |
| `PUT` | `/v1/skills/:name` | Create/update skill |
| `POST` | `/v1/search` | Web search |

---

<details>
<summary><strong>Architecture</strong></summary>

```
┌──────────────────────────────────────────────────────┐
│                    Orchestrator                       │
│    (spawns each agent as an independent OS process)   │
└────┬──────────────────┬──────────────────┬───────────┘
     │                  │                  │
 ┌───▼───┐         ┌───▼────┐        ┌───▼────┐
 │Planner│ ──────► │Executor│ ──────►│Advisor │    Agents
 └───┬───┘         └───┬────┘        └───┬────┘
     │                  │                  │
     ▼                  ▼                  ▼
 ┌─────────────────────────────────────────────┐
 │  TaskBoard  ·  ContextBus  ·  Mailbox       │  File-backed
 │  (file-lock)   (shared KV)   (P2P JSONL)    │  coordination
 └──────────────────┬──────────────────────────┘
                    │
 ┌──────────────────▼──────────────────────────┐
 │  Reputation Scorer  ·  Peer Review          │
 │  Evolution Engine (Path A / B / C)          │  Reputation
 └──────────────────┬──────────────────────────┘
                    │
 ┌──────────────────▼──────────────────────────┐
 │  ERC-8004 Identity  ·  Lit PKP              │
 │  Gnosis Safe  ·  X.402 Payment              │  On-chain
 └─────────────────────────────────────────────┘
```

### Project Structure

```
swarm-dev/
├── main.py                     # CLI entry point
├── config/agents.yaml          # Team definition
├── core/
│   ├── orchestrator.py         # Process launcher
│   ├── agent.py                # Task execution loop
│   ├── task_board.py           # File-locked task lifecycle
│   ├── gateway.py              # HTTP API + dashboard
│   ├── workflow.py             # Declarative workflow engine
│   ├── onboard.py              # Setup wizard
│   └── doctor.py               # Health checks
├── adapters/
│   ├── llm/                    # FLock · OpenAI · Ollama
│   ├── memory/                 # Hybrid · ChromaDB · Episodic · KB
│   └── chain/                  # ERC-8004 · Lit PKP · Gnosis
├── reputation/                 # Scoring + evolution engine
├── skills/                     # Hot-reload markdown skills
├── workflows/                  # YAML workflow templates
└── docs/                       # Per-agent cognition profiles
```

</details>

---

## Requirements

- Python 3.10+
- One LLM API key (FLock, OpenAI, or local Ollama)

**Core deps:** `httpx` `pyyaml` `filelock` `rich` `questionary`
**Optional:** `chromadb` (vector memory) · `web3` (on-chain features)

---

## License

MIT
